# 프로젝트 퀀텀 리프 제품 요구사항 문서 (PRD) v1.1 (최종)

## 문서 정보
- **문서 버전**: 1.1 (레버리지, 실전 투입, 포지션/수익 실현 전략 반영)
- **최종 수정일**: 2025년 6월 27일
- **소유자**: 강현모

## 1. 프로젝트 개요 (Overview)
본 문서는 '프로젝트 퀀텀 리프'의 목표, 범위, 그리고 핵심 요구사항을 정의하는 최상위 설계도이다. 본 프로젝트는 데이터 기반의 자동화된 암호화폐 스윙 트레이딩 시스템을 구축하여, 지속 가능하고 통계적으로 유의미한 알파(Alpha) 창출을 목표로 한다.

### 1-1. 목표 (Goal)
암호화폐 시장에서 '단순 보유(Buy & Hold)' 전략을 초과하는 지속 가능한 알파(Alpha)를 창출하는 것을 목표로, 4시간봉 OHLCV 데이터를 기반으로 한 자동화된 스윙 트레이딩 시스템을 구축한다.

### 1-2. 핵심 성공 지표 (Key Performance Indicators, KPIs)
개발된 최종 모델은 워크 포워드 분석(Walk-Forward Analysis) 결과, 아래 기준을 모두 만족해야만 실거래 배포 대상으로 고려된다.
- **샤프 지수 (Sharpe Ratio)**: 1.2 이상
- **칼마 지수 (Calmar Ratio)**: 1.0 이상
- **최대 낙폭 (Maximum Drawdown, MDD)**: 25% 미만
- **워크 포워드 효율성 (WFE)**: 60% 이상
- **손익비 (Profit Factor)**: 1.75 이상

### 1-3. 대상 자산 및 시장
- **대상 자산 (초기)**: BTC/USDT 선물 (Perpetual Futures)
- **거래소**: 바이낸스(Binance)
- **투자 스타일**: 스윙 트레이딩 (4시간 봉 기반)

## 2. 프로젝트 규약 (Conventions)
본 프로젝트의 모든 코드는 아래의 '헌법'을 준수하여 일관성과 유지보수성을 확보한다.

### 2-1. 기술 스택 (Tech Stack)
- **데이터 처리**: pandas, numpy
- **API 통신 (거래소)**: ccxt
- **머신러닝 모델**: LightGBM (주력)
- **하이퍼파라미터 최적화**: Optuna
- **백테스팅**: Backtrader (최종 검증)
- **자동화 및 운영**: APScheduler, systemd

### 2-2. 네이밍 및 설계 원칙
- **파일 및 변수**: snake_case (예: data_loader.py, btc_price_df)
- **클래스**: PascalCase (예: TradingSystem)
- **함수**: verb_noun 형식의 snake_case (예: load_data)
- **함수 설계**: 단일 책임 원칙, 타입 힌트 명시

## 3. 핵심 전략 및 파라미터 (Core Strategy & Parameters)

### 3-1. 데이터 전략
- **데이터 소스**: 바이낸스(Binance) API를 통해 직접 수집.
- **데이터 기간**: 최근 7년치 OHLCV 데이터를 수집하되, 모델 훈련에는 최근 5년치를 사용하는 것을 공식 기준으로 한다.
- **품질 보증**: 수집된 모든 데이터에 대해 결측치, 이상치, 중복 데이터에 대한 엄격한 데이터 품질 감사(Data Quality Audit)를 선행한다.

### 3-2. 모델링 및 수익 실현 전략
- **문제 정의**: 분류(Classification) 문제로 접근한다.
- **타겟 레이블링 및 수익 실현**: 리스크 관리가 내재된 **'삼중 장벽 기법(Triple Barrier Method)'**을 사용한다.
  - **수익 실현 (Take-Profit)**: 상단 장벽(익절 라인)은 손절매 거리의 1.5배로 설정하여, 손익비를 1:1.5로 고정한다.
  - **손절매 (Stop-Loss)**: 하단 장벽(손절 라인)은 아래 '리스크 관리 전략'을 따른다.
  - **시간 제한 (Time-Out)**: 일정 기간(예: 10개의 4시간봉) 내에 승부가 나지 않으면 포지션을 종료한다.
- **검증**: 데이터 유출을 원천 차단하는 **시계열 교차검증(TimeSeriesSplit)**을 사용한다.

### 3-3. 리스크 관리 전략
- **증거금 모드**: 격리 증거금(Isolated Margin) 모드 사용을 원칙으로 한다.
- **포지션 사이징**: '명목 가치 기반 2% 리스크' 규칙을 적용한다.
  1. 최대 손실액 계산: 전체 계좌 자본 × 2%
  2. 손절 거리 계산: | 진입가 - 손절가 |
  3. 포지션 규모 확정: 최대 손실액 ÷ 손절매 거리
- **손절매**: 변동성에 적응하는 '2배 ATR(Average True Range) 기반' 손절 규칙을 적용한다.
- **레버리지 운용**:
  - **최대 허용 레버리지**: MDD 관리를 위해 3배로 제한한다.
  - **'절대 청산 회피' 메커니즘**: 모든 주문 실행 전, 손절 가격이 예상 청산 가격보다 안전한지 시스템적으로 검증하며, 위험 시 거래를 자동으로 거부한다.

## 4. 시스템 아키텍처 (System Architecture)
- **핵심 설계 사상**: **모듈형 이벤트 기반 아키텍처 (Modular, Event-Driven Architecture)**를 채택하여 시스템의 각 기능을 독립적인 모듈로 분리 개발한다.
- **논리적 워크플로우**: 스케줄러 → 데이터 수집 → 피처 생성 → 모델 예측 → 리스크 검증 → 주문 실행 → 로깅
- **물리적 폴더 구조**: data, docs, src, notebooks, tests 등 표준화된 폴더 구조를 사용한다.

## 5. 기능 요구사항 (Functional Requirements)
- **FR-1**: 데이터 수집, 품질 감사, 정제 파이프라인.
- **FR-2**: '피처 엔지니어링 계획서'에 명시된 모든 피처를 생성하는 모듈.
- **FR-3**: LightGBM 모델 훈련 및 '삼중 장벽' 기반 예측 파이프라인.
- **FR-4**: 레버리지와 청산 리스크를 시뮬레이션하는 현실적인 백테스팅 엔진.
- **FR-5**: '절대 청산 회피' 로직을 포함한 ccxt 선물 주문 실행 모듈.
- **FR-6**: 모든 시스템 활동을 기록하는 구조화된 로깅 및 텔레그램 알림 시스템.

## 6. 비기능적 요구사항 (Non-Functional Requirements)
- **성능**: 새로운 4시간 봉 데이터 수신 후, 1분 이내에 모든 계산 및 거래 결정이 완료되어야 한다.
- **안정성**: 연간 99.9%의 가동 시간을 목표로 하며, 오류 발생 시 10초 내 자동 재시작되어야 한다.
- **보안**: 모든 민감 정보는 환경 변수를 통해서만 관리되어야 한다.

## 7. 범위 외 사항 (Out of Scope)
- **v1.0에서는 다음을 포함하지 않는다:**
  - 초단타(스캘핑) 전략.
  - 다중 자산 포트폴리오 최적화.
  - 웹 기반 사용자 인터페이스(UI).

## 8. 가정 및 의존성 (Assumptions & Dependencies)
- **가정**: 과거 시장의 통계적 특성이 미래에도 일정 수준 반복될 것이라고 가정한다.
- **의존성**: 바이낸스 거래소의 API 및 ccxt 등 핵심 라이브러리들이 안정적으로 제공될 것에 의존한다.

## 9. 실전 투입 계획 (Go-Live Plan)
본격적인 자금 투입 전, 다음 3단계의 프로토콜을 반드시 순차적으로 통과해야 한다.

### 1단계: 페이퍼 트레이딩 (기술 검증)
- **목표**: 시스템의 모든 기술적 요소(API, 주문, 로깅 등)가 실제 환경에서 완벽하게 작동하는지 검증.
- **성공 기준**: 최소 1개월 운영 또는 20회 이상의 무오류 거래 기록.

### 2단계: 인큐베이션 (현실 마찰 측정)
- **목표**: 소액의 실전 자금(총예산의 1~5%)으로, 실제 슬리피지와 수수료가 백테스트와 얼마나 다른지 정량적으로 측정.
- **성공 기준**: 실제 거래 성과와 '마찰 조정 백테스트' 성과의 '성과 일치 비율'이 80% 이상일 것.

### 3단계: 최종 Go/No-Go 결정
- **목표**: 모든 기술적, 운영적, 보안적 준비 상태를 '최종 Go/No-Go 결정 매트릭스' 체크리스트를 통해 최종 점검하고, 본격적인 자금 투입을 결정.

## 10. 세부 계획서 링크
- **데이터 전략**: docs/01_data_strategy.md
- **백테스팅 및 리스크 관리**: docs/02_backtesting_and_risk.md
- **피처 엔지니어링 및 모델링**: docs/03_feature_and_model.md
- **시스템 아키텍처 및 운영**: docs/04_system_architecture.md
- **레버리지 운용 전략**: docs/05_leverage_strategy.md
- **실전 투입 프로토콜**: docs/06_go_live_protocol.md
