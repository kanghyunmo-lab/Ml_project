# 프로젝트 퀀텀 리프: AI 작업 브리핑 (CONTEXT.md)

## [PART 1] 핵심 원칙 (Project Constitution)
*(이 부분은 프로젝트의 '헌법'으로, 거의 수정되지 않습니다)*

### 1. 프로젝트 목표 및 성공 기준 (KPIs)
- **목표**: 4시간봉 기반 BTC/USDT 선물 스윙 트레이딩 자동화 시스템 구축
- **핵심 성공 지표 (KPIs)**: 워크 포워드 분석 결과, 아래 기준을 모두 충족해야 함.
  - Sharpe Ratio > 1.2
  - Max Drawdown < 25%
  - Calmar Ratio > 1.0
  - Profit Factor > 1.75
  - Walk-Forward Efficiency > 60%

### 2. 핵심 아키텍처 및 기술 스택 (Core Architecture & Tech)
- **설계 사상**: 모듈형 이벤트 기반 아키텍처 (Modular, Event-Driven Architecture)
- **기술 스택**: Python, pandas, ccxt, LightGBM, Backtrader, Optuna, APScheduler
- **코딩 규약**: CONVENTIONS.md 파일의 네이밍/설계 원칙을 따름.

### 3. 핵심 리스크 및 거래 전략 (Core Risk & Trade Strategy)
- **포지션 사이징**: 명목 가치 기반 2% 리스크 규칙
- **손절매 (Stop-Loss)**: 2배 ATR 기반
- **수익 실현 (Take-Profit)**: 손절매 거리의 1.5배 (손익비 1:1.5 고정). '삼중 장벽 기법'에 의해 통합 관리됨.
- **레버리지**: 최대 3배로 제한.
- **절대 원칙**: '절대 청산 회피 메커니즘' 필수. 모든 거래 전, 손절 가격과 예상 청산 가격을 비교/검증함.

---

## [PART 2] 현재 상태 보고 (Current Status)
*(이 부분은 Task를 완료할 때마다 업데이트됩니다)*

### 4. 현재까지 완료된 작업
### Phase 1: 기반 공사 (Foundation & Data Pipeline)
**목표:** 프로젝트의 기본 구조를 만들고, 모델 훈련에 사용할 깨끗하고 신뢰성 있는 데이터를 완벽하게 준비한다.

- [X] **Task 1.1: 프로젝트 초기화 및 문서화**
    - [X] 로컬에 프로젝트_퀀텀_리프 폴더 생성
    - [X] Git 저장소 초기화 (git init)
    - [X] PRD.md 및 docs/ 폴더 내 모든 세부 계획서 문서화 완료
- [X] **Task 1.2: 데이터 수집 모듈 구현**
    - [X] src/collection/binance_collector.py 파일 생성
    - [X] 바이낸스 API를 통해 지정된 기간의 4H OHLCV 데이터를 수집하는 함수 구현
    - [X] 수집된 데이터를 data/raw/ 폴더에 Parquet 형식으로 저장하는 기능 구현
- [X] **Task 1.3: 데이터 품질 감사 모듈 구현**
    - [X] src/processing/audit.py 파일 생성
    - [X] 원본 데이터의 결측치, 중복, 이상치를 탐지하여 리포트를 생성하는 함수 구현
- [X] **Task 1.4: 데이터 정제 모듈 구현**
    - [X] src/processing/clean.py 파일 생성
    - [X] 감사 리포트를 바탕으로 데이터를 정제하고, data/processed/ 폴더에 저장하는 함수 구현

### Phase 2: 핵심 엔진 개발 (Core Engine Development)
**목표:** 정제된 데이터를 바탕으로 예측 모델을 만들고, 그 성능을 엄격하게 검증할 수 있는 백테스팅 엔진을 완성한다.

- [X] **Task 2.1: 피처 엔지니어링 모듈 구현**
    - [X] src/processing/feature_engineer.py 파일 생성
    - [X] PRD에 명시된 모든 기술적 지표 및 파생 변수(ATR, RSI, MACD 등)를 계산하여 데이터프레임에 추가하는 함수 구현
- [X] **Task 2.2: 타겟 레이블링 모듈 구현**
    - [X] src/modeling/labeler.py 파일 생성
    - [X] '삼중 장벽 기법'에 따라 수익실현/손절매/시간제한 라인을 설정하고, 1(매수 성공), -1(손절), 0(횡보)으로 레이블링하는 함수 구현
- [X] **Task 2.3: 모델 훈련 파이프라인 구현**
    - [X] src/modeling/trainer.py 파일 생성
    - [X] TimeSeriesSplit을 이용한 시계열 교차검증 구조 구현
    - [X] Optuna를 사용하여 LightGBM 모델의 하이퍼파라미터를 최적화하고, 훈련된 최종 모델을 파일로 저장하는 기능 구현
    - [X] 모델 평가 지표 구현 (정확도, F1 점수, 혼동 행렬 등)



### 5. 현재 모델 성능 (2025-06-28 기준)
- **테스트 세트 정확도**: 86.24%
- **가중 F1 점수**: 82.32%
- **주요 이슈**: 클래스 불균형으로 인해 모델이 횡보(0) 클래스에 편향되는 현상이 관찰됨
- **개선 방안**:
  - 클래스 가중치 조정 또는 오버샘플링 기법 적용
  - 피처 엔지니어링 개선을 통한 예측력 향상
  - 교차검증 전략의 세밀한 조정

### 5. 다음에 수행할 작업 (Next Task)

- [ ] **Task 2.5: 통합 테스트 및 검증**
    - [ ] end-to-end 파이프라인 테스트 (데이터 수집 → 전처리 → 모델 학습 → 백테스트)
    - [ ] 워크 포워드 분석(워크 포워드 최적화) 구현
    - [ ] PRD에 명시된 모든 KPI 기준 충족 여부 검증
    - [ ] 성능 최적화 및 버그 수정

### Phase 2.5: 전략 개선 및 최적화 (Strategy Improvement)
**목표:** 백테스트 결과를 분석하여 전략을 개선하고, 수익성을 높인다.

- [ ] **Task 2.6: 백테스트 결과 심층 분석**
    - [ ] 거래 로그 상세 분석 (승률, 평균 수익/손실, 연속 손실 등)
    - [ ] 손실이 큰 구간의 시장 상황 분석 (변동성, 거래량, 뉴스 이벤트 등)
    - [ ] 모델 예측 정확도와 실제 수익률의 상관관계 분석

- [ ] **Task 2.7: 전략 개선 방안 수립**
    - [ ] 진입/청신 신호 최적화 (지표 파라미터 조정, 다중 타임프레임 분석 추가)
    - [ ] 손절매/익절 전략 개선 (ATR 기반 동적 손절매, 트레일링 스탑 추가)
    - [ ] 포지션 사이징 전략 개선 (볼린저 밴드 변동성 기반 리스크 조정)
    - [ ] 필터링 조건 추가 (거래량, 변동성, 시장 심리 지표 등)

- [ ] **Task 2.8: 모델 성능 개선**
    - [ ] 추가 피처 엔지니어링 (시계열 특성, 기술적 지표 조합 등)
    - [ ] 앙상블 모델 적용 (LightGBM + CatBoost 등)
    - [ ] 불균형 데이터 처리 (SMOTE, 클래스 가중치 조정)
    - [ ] 하이퍼파라미터 추가 최적화

- [ ] **Task 2.9: 검증 및 반복**
    - [ ] 개선된 전략으로 백테스트 재실행
    - [ ] 워크 포워드 최적화(WFO)를 통한 과적합 방지
    - [ ] 몬테카를로 시뮬레이션으로 전략의 견고성 검증
    - [ ] 모든 KPI가 목표치를 달성할 때까지 반복 개선

### Phase 3: 자동화 시스템 구축 (Automation & Execution)
**목표:** 검증된 모델과 전략을 사람의 개입 없이 24시간 자동으로 실행할 수 있는 완전한 시스템으로 조립한다.

- [ ] **Task 3.1: 리스크 관리 모듈 구현**
    - [ ] src/execution/risk_manager.py 파일 생성
    - [ ] '명목 가치 기반 2% 룰'에 따라 포지션 규모를 계산하는 함수 구현
    - [ ] '절대 청산 회피' 로직을 구현하여, 모든 거래 전에 손절 가격과 예상 청산 가격을 비교/검증하는 기능 구현
- [ ] **Task 3.2: 주문 실행 모듈 구현**
    - [ ] src/execution/order_handler.py 파일 생성
    - [ ] ccxt를 사용하여 바이낸스 선물 시장에 격리 모드 및 레버리지를 설정하는 기능 구현
    - [ ] 리스크 관리 모듈의 검증을 통과한 거래를 실제 지정가/시장가 주문으로 전송하는 기능 구현
    - [ ] OCO 주문을 활용하여 익절/손절 주문을 자동으로 관리하는 기능 구현
- [ ] **Task 3.3: 모니터링 시스템 구현**
    - [ ] src/monitoring/logger.py 파일에 중앙 로깅 설정 구현
    - [ ] src/monitoring/alerter.py 파일에 텔레그램으로 긴급 오류 알림을 보내는 함수 구현
- [ ] **Task 3.4: 메인 실행 스크립트 작성**
    - [ ] main.py 파일 작성
    - [ ] APScheduler를 사용하여 정해진 시간(4시간마다)에 '데이터 수집 → 피처 생성 → 모델 예측 → 리스크 검증 → 주문 실행'의 전체 워크플로우를 실행하는 로직 구현
