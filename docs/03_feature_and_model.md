# 피처 엔지니어링 및 모델링 계획서 (v1.0)

**기준 문서:** PRD v1.1, 최종 실행 계획서

---

## 1. 개요
본 문서는 정제된 OHLCV 데이터로부터 예측에 유의미한 피처(Feature)를 생성하고, 이를 학습하여 미래 가격 방향을 예측하는 머신러닝 모델을 구축하는 전 과정을 기술합니다.

## 2. 피처 엔지니어링 (src/processing/feature_engineer.py)
- **목표:** 원본 데이터로부터 추세, 모멘텀, 변동성 등 시장의 다양한 측면을 나타내는 파생 변수를 생성
- **생성 피처 목록:**
    - 기초 피처: 다기간 로그 수익률, ATR, 캔들 정보(몸통 비율 등)
    - 기술적 지표 (추세): 다기간 이동평균(SMA, EMA) 및 그 비율, MACD (선, 신호, 히스토그램), ADX (+DI, -DI 포함)
    - 기술적 지표 (모멘텀): 다기간 RSI, 스토캐스틱 오실레이터 (%K, %D), ROC
    - 기술적 지표 (변동성): 볼린저 밴드 (%B, Bandwidth)
    - 거래량 기반: OBV의 이동평균, Chaikin Money Flow, 거래량 급증(Volume Spike)
    - 시간 기반: 요일, 월 등 달력 피처 (주기성을 고려한 Sine/Cosine 변환 적용)
- **피처 선별:**
    - VIF (분산 팽창 계수)를 사용하여 다중공선성이 높은 피처를 제거
    - 순열 피처 중요도(PFI)와 SHAP 분석을 통해 모델 예측에 실질적으로 기여하는 피처만 최종 선별

## 3. 모델링 파이프라인

### 3-1. 문제 정의 및 타겟 레이블링 (src/modeling/labeler.py)
- **문제 정의:** '상승', '하락', '횡보'를 예측하는 3중 분류(Multi-class Classification) 문제로 접근
- **타겟 레이블링:** **'삼중 장벽 기법(Triple Barrier Method)'** 사용
    1. 상단 장벽 (수익 실현): 진입가 + (손절매 거리 × 1.5)
    2. 하단 장벽 (손절매): 진입가 - (2 × ATR)
    3. 수직 장벽 (시간 제한): 10개의 4시간봉 (40시간)
    - 위 3개 장벽 중 가장 먼저 도달하는 것에 따라 1(상단), -1(하단), 0(수직)으로 레이블 부여

### 3-2. 모델 훈련 및 최적화 (src/modeling/trainer.py)
- **주력 모델:** LightGBM Classifier
- **검증 방법:** 데이터의 시간 순서를 보존하는 **sklearn.model_selection.TimeSeriesSplit**을 사용한 교차검증 수행
- **하이퍼파라미터 최적화:** Optuna 라이브러리를 사용한 베이지안 최적화를 통해 최적의 하이퍼파라미터 탐색
- **출력:** 훈련 및 최적화가 완료된 최종 모델 객체는 파일(예: lgbm_model.pkl)로 저장

### 3-3. 예측 (src/modeling/predictor.py)
- **담당 모듈:** predictor.py
- **핵심 기능:** 저장된 모델을 불러와, 새로운 데이터에 대한 예측(1, -1, 0)을 수행하고 그 결과를 반환
