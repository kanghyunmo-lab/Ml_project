# 레버리지 운용 전략 계획서 (v1.0)

**기준 문서:** PRD v1.1, 최종 실행 계획서

---

## 1. 개요
본 문서는 수익률 증대를 위해 암호화폐 선물 시장의 레버리지를 활용하되, 청산(Liquidation) 리스크를 통제하고 파산을 방지하는 체계적인 운용 전략을 정의합니다.

## 2. 핵심 운용 원칙
1. **리스크 기준의 전환:** 리스크는 투입된 증거금이 아닌, 포지션이 실제로 통제하는 **'명목 가치(Notional Value)'**를 기준으로 관리
2. **청산은 시스템의 실패:** 절대 청산당하지 않는 것을 리스크 관리의 최우선 목표로 삼음
3. **리스크와 레버리지의 분리:** 레버리지는 리스크의 크기를 결정하는 도구가 아닌, 정해진 리스크의 포지션을 유지하기 위한 **'자본 효율성 도구'**로만 사용

## 3. 기술적 구현 및 리스크 통제

### 3-1. 증거금 및 레버리지 설정
- **증거금 모드:** 격리 증거금(Isolated Margin) 모드만 사용하여 개별 거래의 리스크를 분리
- **최대 허용 레버리지:** 시스템의 안정성과 MDD 관리를 위해, 최대 허용 레버리지를 **3배(3x)**로 제한

### 3-2. '절대 청산 회피' 메커니즘
- **담당 모듈:** src/execution/risk_manager.py
- **실행 절차:** 모든 주문을 실행하기 직전에, 아래의 검증 절차를 시스템적으로 강제
    1. ATR 기반 손절 가격 계산: 진입가 - (2 × ATR) (롱 포지션 기준)
    2. 예상 청산 가격 계산: 사용할 레버리지와 거래소의 유지 증거금률(MMR)을 바탕으로, 시스템이 강제 청산될 가격을 계산
    3. 안전성 최종 검증:
        - 손절 가격이 예상 청산 가격보다 반드시 안전한 위치에 있는지 확인
        - (롱 포지션의 경우: 손절 가격 > 예상 청산 가격 이어야 함)
    4. 자동 거래 거부: 위 검증에 실패할 경우, 해당 거래는 청산 위험이 높다고 판단하여 자동으로 진입을 거부하고, 개발자에게 알림을 보냄

### 3-3. 펀딩비(Funding Rate) 관리
- **인식:** 장기간 포지션을 유지하는 스윙 트레이딩 전략에서, 펀딩비는 수익률에 영향을 미치는 중요한 '비용' 요소로 인식
- **처리:** 백테스팅 시, 8시간마다 발생하는 펀딩비를 포지션의 명목 가치 기준으로 정확히 계산하여 총 손익에 반영. 이를 통해 전략의 실제 기대 수익률을 더 현실적으로 평가

## 4. ccxt 라이브러리 선물 거래 구현 가이드
- **인스턴스 생성:** 선물 거래용 인스턴스는 ccxt.binanceusdm() 또는 options={'defaultType': 'future'} 옵션을 통해 명시적으로 생성
- **핵심 함수:**
    - exchange.set_margin_mode('ISOLATED', symbol)
    - exchange.set_leverage(leverage, symbol)
    - exchange.create_market_order(symbol, side, amount)
    - exchange.fetch_positions() (현재 포지션 상태 조회)
