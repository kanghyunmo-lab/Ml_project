# 시스템 아키텍처 및 운영 계획서 (v1.0)

**기준 문서:** PRD v1.1, 최종 실행 계획서

---

## 1. 개요
본 문서는 '프로젝트 퀀텀 리프'의 모든 기술적 구성요소를 통합하여, 24시간 안정적으로 작동하는 자동화 시스템을 구축하기 위한 기술적 청사진과 운영 전략을 정의합니다.

## 2. 시스템 아키텍처

### 2-1. 핵심 설계 사상
- **모듈형 설계:** 모든 기능(데이터, 모델, 주문 등)은 독립적인 모듈로 개발하여 src/ 폴더 내에 각자의 책임에 따라 배치. 코드의 재사용성과 유지보수성을 극대화
- **이벤트 기반 흐름:** 시스템은 정해진 스케줄에 따라 '이벤트'가 발생하면, 각 모듈이 순차적으로 작동하는 방식으로 설계

### 2-2. 논리적 워크플로우
```
graph TD
    A[스케줄러 실행 (4시간마다)] --> B[데이터 수집 모듈];
    B --> C[데이터 처리/피처 생성 모듈];
    C --> D[모델 예측 모듈];
    D --> E{리스크 관리 모듈};
    E -- 거래 조건 충족 --> F[주문 실행 모듈];
    E -- 조건 미충족/위험 --> G[사이클 종료];
    F --> H[거래소에 주문 전송];
    subgraph "상시 작동"
        L[중앙 로깅 시스템]
        M[텔레그램 알림 시스템]
    end
    B -- 로그 기록 --> L;
    D -- 로그 기록 --> L;
    F -- 거래 기록 --> L;
    H -- 치명적 오류 발생 --> M;
```

## 3. 자동화 및 운영

### 3-1. 스케줄링 (main.py 및 OS)
- **내부 스케줄러:** 파이썬 APScheduler 라이브러리를 사용하여, 4시간마다 위 워크플로우를 실행하는 잡(Job)을 등록
- **외부 프로세스 관리:** 전체 파이썬 애플리케이션(main.py)은 리눅스의 systemd 서비스를 통해 관리. 서버가 재부팅되거나 스크립트가 예기치 않게 종료되었을 때 자동으로 재시작되도록 보장

### 3-2. 배포 환경
- **서버:** AWS EC2 t3.small 또는 유사 사양의 클라우드 서버 사용 권장
- **운영체제:** Ubuntu Server LTS 버전
- **환경 관리:** 파이썬 가상 환경(venv)을 사용하여 프로젝트의 의존성을 격리

### 3-3. 보안
- **API 키 관리:** 모든 민감 정보(API 키, 텔레그램 토큰 등)는 .env 파일과 python-dotenv 라이브러리를 사용하여 환경 변수로 관리. .env 파일은 .gitignore에 추가하여 절대 Git 저장소에 커밋되지 않도록 함
- **서버 접근 제어:** 서버의 SSH 접속(포트 22)은 지정된 IP 주소에서만 가능하도록 보안 그룹 설정

### 3-4. 모니터링 (src/monitoring/)
- **로깅:** 파이썬 내장 logging 모듈을 사용하여 모든 시스템 활동, 결정, 오류를 파일로 기록. 로그는 INFO, WARNING, ERROR 등 수준별로 관리
- **알림:** 치명적인 오류 발생 시(예: API 키 무효, 잔고 부족 등), alerter.py 모듈이 텔레그램 봇을 통해 개발자에게 즉시 알림
